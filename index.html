<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wiggle Zoo ‚Äì „Åú„Çì„Å∂„ÅÇ„Åù„Åº„ÅÜÔºÅ</title>
  <style>
    :root {
      --bg: #ffffff;
      --card-bg: #ffffff;
      --card-shadow: 0 4px 12px rgba(0,0,0,0.08);
      --radius: 1.5rem;
      --brand: #ff6b6b;
      --brand-alt: #ffa502;
      --card-size: 200px;
      --gap: 16px;
    }
    html,body{margin:0;padding:0;width:100%;height:100%;background:var(--bg);font-family:"Segoe UI","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;overflow:hidden;display:flex;flex-direction:column;}
    .header{flex:0 0 auto;padding:.8rem 1.2rem;display:flex;align-items:center;gap:1rem;background:#f3f4f6;box-shadow:0 2px 6px rgba(0,0,0,.06);} .title{font-size:1.6rem;font-weight:700;color:var(--brand);margin-right:auto;display:flex;align-items:center;gap:.4rem;}
    button.ui-btn{padding:.4rem .9rem;font-size:.9rem;font-weight:600;border:none;border-radius:999px;cursor:pointer;background:var(--brand);color:#fff;transition:background .2s;} button.ui-btn.alt{background:var(--brand-alt);} button.ui-btn:hover{background:#ff5050;} button.ui-btn:active{background:#e63838;}
    #zoo-container{position:relative;flex:1 1 auto;width:100%;height:100%;}
    .zoo-card{width:var(--card-size);height:var(--card-size);background:var(--card-bg);border-radius:var(--radius);box-shadow:var(--card-shadow);display:flex;align-items:center;justify-content:center;position:absolute;cursor:pointer;transition:transform .15s ease-out;user-select:none;} .zoo-card img{width:90%;height:90%;object-fit:contain;pointer-events:none;}
    @keyframes wiggle{0%{transform:rotate(0) translateY(0);}25%{transform:rotate(6deg) translateY(-4%);}50%{transform:rotate(0) translateY(0);}75%{transform:rotate(-6deg) translateY(-4%);}100%{transform:rotate(0) translateY(0);}} @keyframes bounce{0%,100%{transform:translateY(0);}40%{transform:translateY(-15%);}60%{transform:translateY(-8%);}} @keyframes spin{0%{transform:rotate(0);}100%{transform:rotate(360deg);} }
    .anim-wiggle{animation:wiggle .8s ease-in-out infinite;} .anim-bounce{animation:bounce .9s ease-in-out infinite;} .anim-spin{animation:spin 1.2s linear infinite;}
  </style>
</head>
<body>
  <div class="header">
    <div class="title">üêæ Wiggle Zoo</div>
    <button id="btn-all" class="ui-btn">„Åú„Çì„Å∂„Å†„Å£„ÅìÔºÅ</button>
    <button id="btn-shuffle" class="ui-btn alt">„Ç∑„É£„ÉÉ„Éï„É´</button>
  </div>
  <div id="zoo-container"></div>

  <script>
    const animals=["cat","dog","elephant","lion","cow","chicken","horse","goat"];
    const animations=["wiggle","bounce","spin"];
    const CARD_SIZE=200,GAP=16;
    const isAndroid=/Android/i.test(navigator.userAgent);
    const MAX_PLAYS=3;

    const container=document.getElementById("zoo-container"),header=document.querySelector(".header"),btnAll=document.getElementById("btn-all"),btnShuffle=document.getElementById("btn-shuffle");
    let cards=[],allMode=false;

    const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;};

    const gridPositions=()=>{const h=header.offsetHeight,totalW=4*CARD_SIZE+3*GAP,offX=Math.max(GAP,(window.innerWidth-totalW)/2),offY=h+GAP,pos=[];for(let r=0;r<2;r++){for(let c=0;c<4;c++){pos.push({x:offX+c*(CARD_SIZE+GAP),y:offY+r*(CARD_SIZE+GAP)});} }return pos;};

    /* ------- Unlock audio helper -------- */
    let audioUnlocked=false;
    function unlockAudio(){
      if(audioUnlocked) return;
      audioUnlocked=true;
      cards.forEach(({audio})=>{
        try{
          audio.muted=true;
          const p=audio.play();
          if(p){p.then(()=>{audio.pause();audio.currentTime=0;audio.muted=false;});}
        }catch(e){}
      });
    }
    // Any click / touch will unlock
    window.addEventListener("pointerdown",unlockAudio,{once:false});
    window.addEventListener("touchstart",unlockAudio,{once:false});

    function createCard(name,pos){
      const card=document.createElement("div");card.className="zoo-card";card.style.left=`${pos.x}px`;card.style.top=`${pos.y}px`;
      const img=document.createElement("img");img.src=`${name}.png`;img.alt=name;card.appendChild(img);

      const audio=new Audio(`${name}.mp3`);
      audio.preload="auto";
      if(!isAndroid){audio.loop=true;}
      else{audio._count=0;audio.addEventListener("ended",()=>{if(audio._playActive&&audio._count<MAX_PLAYS-1){audio._count++;audio.currentTime=0;audio.play().catch(()=>{});}else{audio._playActive=false;}});}

      const animClass=`anim-${animations[Math.floor(Math.random()*animations.length)]}`;

      const start=()=>{
        unlockAudio();
        img.classList.add(animClass);
        audio._playActive=true;audio._count=0;
        audio.currentTime=0;
        audio.play().catch(()=>{});
      };
      const stop=()=>{img.classList.remove(animClass);audio._playActive=false;audio.pause();audio.currentTime=0;};

      card.addEventListener("mouseenter",start);
      card.addEventListener("mouseleave",stop);
      card.addEventListener("touchstart",e=>{e.preventDefault();img.classList.contains(animClass)?stop():start();});
      container.appendChild(card);
      cards.push({img,audio,animClass});
    }

    function placeCards(){container.innerHTML="";cards=[];const positions=gridPositions(),names=shuffle([...animals]);names.forEach((n,i)=>positions[i]&&createCard(n,positions[i]));}

    placeCards();

    btnAll.addEventListener("click",()=>{unlockAudio();allMode=!allMode;btnAll.textContent=allMode?"„Å®„ÇÅ„Çã":"„Åú„Çì„Å∂„Å†„Å£„ÅìÔºÅ";cards.forEach(({img,audio,animClass})=>{if(allMode){img.classList.add(animClass);audio._playActive=true;audio._count=0;audio.currentTime=0;audio.play().catch(()=>{});}else{img.classList.remove(animClass);audio._playActive=false;audio.pause();audio.currentTime=0;}});});

    btnShuffle.addEventListener("click",()=>{cards.forEach(({img,audio,animClass})=>{img.classList.remove(animClass);audio._playActive=false;audio.pause();audio.currentTime=0;});allMode=false;btnAll.textContent="„Åú„Çì„Å∂„Å†„Å£„ÅìÔºÅ";placeCards();});

    window.addEventListener("resize",placeCards);
  </script>
</body>
</html>